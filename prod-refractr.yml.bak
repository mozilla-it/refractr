# these domains will be given a cert and rule through
# the ingress.yaml.template by being added to the domains
# output from refractr.py
default-domains:
  - prod.mozilla-redirects.xyz
  - refractr.mozilla.org

refracts:

  # FIXME: this is a prod test to ensure certs get requested
- mozilla.com/: refractr1.mozilla.org

  # FIXME: this is a prod test to ensure certs get requested
- mozilla.org/: refractr2.mozilla.org

  # bug 20170327
- videos.cdn.mozilla.net/:
  - videos-cdn.mozilla.net
  - videos.mozilla.org
  - videos-ssl-cdn.mozilla.net # FIXME: gives access denied; ok?

  # NOTE: changed from http->https after verifying
  #- www.mozillalabs.com/:
  # FIXME: currently both  are valid
  # but going to simplyfly with a redirect from both
  # going to .org
  # SE-970 bogus redirect FIXME: remove later
#- www.mozillalabs.com/:
#  - labs.mozilla.org
#  - labs.mozilla.com

  # bug 503731, 528747, 537144
- addons.mozilla.org/:
  - extensions.mozilla.org
  - themes.mozilla.org
  - update.mozilla.org
  - updates.mozilla.org
  - addons.update.mozilla.org
  - firefoxaddons.com
  - www.firefoxaddons.com

  # bug 850584
  # NOTE: changed from http->https after verifying
  # FIXME: redirect doesnt currently exist but should work
- download.cdn.mozilla.net/: releases.mozilla.org

  # bug 1259820
- air.mozilla.org/: air.mozilla.com
  status: 302

  # FIXME: change to www subdomain to match prod
- www.mozilla.org/: redirect-san.mozilla.org
  status: 307

  # virtual-redirect-autogen.conf merged into virtual-redirect
  # this used to be generated by a script somehow, but not now.
  # that script was dnsconfig/bin/generate-virtual-redirects.sh
- www.mozilla.org/:
  #- virtual-redirect-mozilla.org FIXME: NXDOMAIN
  #- virtual-redirect-mozilla.com FIXME: NXDOMAIN
  - mozillaservice.net
  - www.mozillaservice.net
  - firefox4all.com
  - www.firefox4all.com
  - firefoxsoftware.com
  - www.firefoxsoftware.com
  #- getfirfox.com FIXME: valid ip, but MarkMonitor page
  #- www.getfirfox.com FIXME: valid ip, but MarkMonitor page
  - update-firefox.com
  - www.update-firefox.com
  - extendfirefox.com
  - www.extendfirefox.com
  - onemozilla.org
  - www.onemozilla.org
  # bug 1234360
  - firefoxflicks.mozilla.org
  # bug 126196
  - mozilla.hu
  - www.mozilla.hu
  # bug 1331870
  - events.mozspaces.org
  # bug 710695, 708705
  - firefoxflicks.com
  - firefoxflicks.org
  - www.firefoxflicks.com
  - www.firefoxflicks.org
  # fashionyourfirefox.com - Modified as per bug 614412
  - fashionyourfirefox.com
  - www.fashionyourfirefox.com
  # We're not using website-beta right now.
  - website-beta.mozilla.org
  # split out store.mozilla.org|com as per bug 1142629
  # modified for bug 1260869 now that gear.mozilla.org has gone away
  - www.store.mozilla.org
  - store.mozilla.org
  - store.mozilla.com
  # bug 619759
  - www.mozilla.net
  # bug 870904
  - mozsecworld.org
  - www.mozsecworld.org
  # bug 841514
  - detodosparatodos.org
  - www.detodosparatodos.org
  #- detodosparatodos.com FIXME: broken but not NXDOMAIN
  #- www.detodosparatodos.com FIXME: broken but not NXDOMAIN
  # bug 1268570
  - firefox-downloaden.de
  # bug 830904
  - communitystore.mozilla.org
  # TODO: can we decom this?
  # bug 1234360
  - mobilepartners.mozilla.org
  # bug 1329125
  - masterfirefoxos.mozilla.org
  status: 302

  # bug 713065
- wiki.mozilla.org/MarketingGuide/: guides.mozilla.org

  # bug 998357
- activations.cdn.mozilla.net/:
  - activations.mozilla.com
  - activations.mozilla.org

  # bug 1246674
- careers.mozilla.org/: careers.mozilla.com
  status: 302

# FIXME: commenting out LE Blacklisted items for now
# https://mana.mozilla.org/wiki/display/SECURITY/Certificate+Authority+Authorization+CAA+including+Let%27s+Encrypt
#  # bug 896570, 1427843, 1485429, 1297860
#- www.mozilla.org/firefox/new/?redirect_source=getfirefox-com:
#  - getfirefox.com
#  - www.getfirefox.com

  # bug 1414285, 1429854
- onlinexperiences.com/scripts/Server.nxp?LASCmd=L:0&AI=1&InitialDisplay=1&ClientBrowser=0&ShowKey=44908: airmo.mozilla.org

  # bug 1485991
  # FIXME: previous redirect is not valid
  #- onlinexperiences.com/scripts/Server.nxp?LASCmd=L:0&AI=1&InitialDisplay=1&ClientBrowser=0&ShowKey=44908: air.mozilla.org
- air.mozilla.org/: air.mozilla.org
  status: 308

  # bug 1543423
- discourse.mozilla.org/: discourse.mozilla-community.org

  # TODO: test this works as before
  # bug 1304806
- phonebook.mozilla.org/: phonebook.mozilla.com
  status: 302

- pad.mozilla.org/: public.etherpad-mozilla.org

- www.mozilla.org/firefox/lockwise/: lockbox.firefox.com

  # bug 835529
- support.mozilla.org/: www.support.mozilla.org
  # bug 149411
  # NOTE: changed from http->https after verifying
  # FIXME: these currently fail due to the complicated mess
  # validation:
  #   netloc: public
  #   tests:
  #   - http://start.mozilla.com -> https://start.mozilla.org/:
  #       hops:
  #       - 307 http://start.mozilla.com -> https://start.mozilla.com/
  #       - 301 https://start.mozilla.com/ -> http://start.mozilla.org/
  #       - 301 http://start.mozilla.org/ -> https://start.mozilla.org/en-US/
  #       - 301 https://start.mozilla.org/en-US/ -> http://start.mozilla.org/en-us/
  #       - 301 http://start.mozilla.org/en-us/ -> https://start.mozilla.org/en-us/
  #       result: MISMATCHED
  #   - http://start-prod.mozilla.com -> https://start.mozilla.org/:
  #       hops:
  #       - 307 http://start-prod.mozilla.com -> https://start-prod.mozilla.com/
  #       - 301 https://start-prod.mozilla.com/ -> http://start.mozilla.org/
  #       - 301 http://start.mozilla.org/ -> https://start.mozilla.org/en-US/
  #       - 301 https://start.mozilla.org/en-US/ -> http://start.mozilla.org/en-us/
  #       - 301 http://start.mozilla.org/en-us/ -> https://start.mozilla.org/en-us/
  #       result: MISMATCHED
- start.mozilla.org/:
  - start.mozilla.com
  - start-prod.mozilla.com

  # bug 1587941
  # TODO: test this works as before
  #- dsts:
  #  - /faq.html/: support.mozilla.org/products/firefox-lockwise/
  #  - /addon/updates.json/: mozilla-lockwise.github.io/addon/updates.json
  #  - /: www.mozilla.org/firefox/lockwise/
  #  srcs: [lockwise.firefox.com]
  #  status: 301
  #  validation:
  #    netloc: public
  #    tests:
  #    - http://lockwise.firefox.com/faq.html/ -> support.mozilla.org/products/firefox-lockwise/:
  #        hops:
  #        - 301 http://lockwise.firefox.com/faq.html/ -> https://lockwise.firefox.com/faq.html/
  #        - 301 https://lockwise.firefox.com/faq.html/ -> https://support.mozilla.org/products/firefox-lockwise//
  #        - 302 https://support.mozilla.org/products/firefox-lockwise// -> http://support.mozilla.org/en-US/products/firefox-lockwise//
  #        - 301 http://support.mozilla.org/en-US/products/firefox-lockwise// -> https://support.mozilla.org/en-US/products/firefox-lockwise//
  #        result: MISMATCHED
  #    - http://lockwise.firefox.com/addon/updates.json/ -> mozilla-lockwise.github.io/addon/updates.json:
  #        hops:
  #        - 301 http://lockwise.firefox.com/addon/updates.json/ -> https://lockwise.firefox.com/addon/updates.json/
  #        - 301 https://lockwise.firefox.com/addon/updates.json/ -> https://mozilla-lockwise.github.io/addon/updates.json/
  #        result: MISMATCHED
  #    - http://lockwise.firefox.com/ -> www.mozilla.org/firefox/lockwise/:
  #        hops:
  #        - 301 http://lockwise.firefox.com/ -> https://lockwise.firefox.com/
  #        - 301 https://lockwise.firefox.com/ -> https://www.mozilla.org/firefox/lockwise/
  #        - 301 https://www.mozilla.org/firefox/lockwise/ -> http://www.mozilla.org/en-US/firefox/lockwise/
  #        - 301 http://www.mozilla.org/en-US/firefox/lockwise/ -> https://www.mozilla.org/en-US/firefox/lockwise/
  #        result: MISMATCHED
- dsts:
  - /faq.html/: support.mozilla.org/products/firefox-lockwise//
  - /addon/updates.json/: mozilla-lockwise.github.io/addon/updates.json/
  - /: www.mozilla.org/firefox/lockwise/
  srcs: lockwise.firefox.com

  # bug 1627952
- dsts:
  - /firefox-accounts-campaign: community.mozilla.org/campaigns/join-firefox-campaign/
  srcs: mozilla.github.io

  # bug 756358
  # TODO: verify this works as expected
- dsts:
  # NOTE: changed from http->https after verifying
  - /dnt-enabler.tpl: www.mozilla.org/media/dnt/dnt-enabler.tpl
  - /: www.mozilla.org/firefox/dnt/
  srcs: dnt.mozilla.org

  # bug 1119912, 1165757, 1213900, 1200359
  # TODO: verify this works as expected / previously
- dsts:
  - /dmexco: 'www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
  - ^/(.+): 'www.mozilla.org/about/partnerships/contentservices/$1/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
  - /: 'www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
  srcs: content.mozilla.org
  status: 302
  tests:
    # this test must be specified because rewrites `^/(.+)` will not generate a test
  - http://content.mozilla.org/test: 'https://www.mozilla.org/about/partnerships/contentservices/test/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'

  # bug 1566155
- dsts:
  - /tree.php/: people.mozilla.org/o
  - ^/search/(.*): 'people.mozilla.org/s?query=$1&who=staff'
  - /: people.mozilla.org/
  srcs: phonebook.mozilla.org
  status: 302
  tests:
    # this test must be specified because rewrites `^/(.*)` will not generate a test
  - http://phonebook.mozilla.org/search/test: https://people.mozilla.org/s?query=test&who=staff

# FIXME: commenting out LE Blacklisted items for now
# https://mana.mozilla.org/wiki/display/SECURITY/Certificate+Authority+Authorization+CAA+including+Let%27s+Encrypt
#- dsts:
#    # bug 1485429, 1432228
#  - /switch: www.mozilla.org/firefox/switch/?redirect_source=firefox-com
#
#  - /mobile: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /beta: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /aurora: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /nightly: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /m: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /tour: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#    # bug 870410
#  - /universityambassadors: www.mozilla.org/contribute/universityambassadors/?redirect_source=firefox-com
#
#  - /os: www.mozilla.org/firefox/os/?redirect_source=firefox-com
#
#    # bug 1004274
#  - /desktop: www.mozilla.org/firefox/desktop/?redirect_source=firefox-com
#
#    # bug 1053356
#  - /android: www.mozilla.org/firefox/android/?redirect_source=firefox-com
#
#    # bug 1091132
#  - /developer: www.mozilla.org/firefox/developer/?redirect_source=firefox-com
#
#    # bug 1091891
#  - /10: www.mozilla.org/firefox/independent/?redirect_source=firefox-com
#
#  - /independant: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#    # bug 1098044
#  - /hello: www.mozilla.org/firefox/hello/?redirect_source=firefox-com
#
#    # bug 1159397
#  - /personal: www.mozilla.org/firefox/personal/?redirect_source=firefox-com
#
#    # FIXME: handle '*' correctly
#  - ^/personal/(.*): www.mozilla.org/firefox/new/$1?redirect_source=firefox-com
#
#    # bug 1219380
#  - /choose: www.mozilla.org/firefox/choose/?redirect_source=firefox-com
#
#    # bug 896570, 1427843
#  - /: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#  srcs:
#  - firefox.com
#  - www.firefox.com

  # bug 1627952
- dsts:
  - /campaigns: community.mozilla.org/campaigns/
  - /commonvoice: community.mozilla.org/activities/contributing-to-common-voice/
  - /en-US/nightly: community.mozilla.org/activities/
  - /webextensions: community.mozilla.org/activities/
  - /rust-hack: community.mozilla.org/activities/
  - /webvr-camp: community.mozilla.org/activities/
  - /webcompat-sprint: community.mozilla.org/activities/
  - /: community.mozilla.org/
  srcs: activate.mozilla.community

  # bug 1618512, 1627952
- dsts:
  - /firefoxvoicecampaign: community.mozilla.org/activities/test-firefox-voice/
  - /respond_campaign: community.mozilla.org/campaigns/respond-campaign/
  - /firefoxforgood-surfacingqualitycontentandconversat: community.mozilla.org/campaigns/
  - /becomeabetatestingbughunter: community.mozilla.org/campaigns/become-a-beta-testing-bughunter/
  - /commonvoice100: community.mozilla.org/campaigns/common-voice-100-hours-sprint/
  - /firefox66supportsprint: community.mozilla.org/groups/support-mozilla-sumo/?view=events
  - /firefoxfightsforyoucampaign: community.mozilla.org/campaigns/firefoxfightsforyoucampaign/
  - /darkfunnelEN: community.mozilla.org/campaigns/become-a-dark-funnel-detective/
  - /: community.mozilla.org/events/
  srcs: events.mozilla.org

#- dsts:
#  - if: '$http_host ~ "^(?<lang>[a-z]{2,3}(-[a-z]{2})?)?\.(start.*)$"'
#    ^: start.mozilla.org/$lang$request_uri
#  - redirect: start.mozilla.org/
#  srcs:
#  - '*.start.mozilla.com'
#  - '*.start2.mozilla.com'
#  - '*.start3.mozilla.com'
#  - '*.start-prod.mozilla.com'
#  tests:
#  - http://ca.start.mozilla.com/: https://start.mozilla.org/ca/
#  - http://en-us.start.mozilla.com/: https://start.mozilla.org/en-us/ # FIXME: note, these don't match current prod
#  - http://en-uk.start.mozilla.com/: https://start.mozilla.org/en-uk/
#
#- dsts:
#  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
#    ^/$: 'www.stopbadware.org/firefox?hl=$hl&url=$url?'
#  - if: '$query_string ~ "^url=(?<url>[^&]+)"'
#    ^/$: 'www.stopbadware.org/firefox?url=$url?'
#  - redirect: $host$request_uri
#  srcs:
#  - malware-error.mozilla.com
#  - '*.malware-error.mozilla.com'
#  tests:
#  - http://malware-error.mozilla.com/?hl=en&url=path: 'https://www.stopbadware.org/firefox?hl=en&url=path'
#  - http://malware-error.mozilla.com/?url=path: 'https://www.stopbadware.org/firefox?url=path'
#  - http://malware-error.mozilla.com/: https://malware-error.mozilla.com/
##  status: 307
#
#- dsts:
#  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&hl=$hl&url=$url?'
#  - if: '$query_string ~ "^url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&url=$url?'
#  - redirect: $host$request_uri
#  srcs:
#  - phish-error.mozilla.com
#  - '*.phish-error.mozilla.com'
#  tests:
#  - http://phish-error.mozilla.com/?hl=en&url=path: 'https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&hl=en&url=path'
#  - http://phish-error.mozilla.com/?url=path: 'https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&url=path'
#  - http://phish-error.mozilla.com/: https://phish-error.mozilla.com/
##  status: 307
#
#- dsts:
#  - if: '$query_string ~ "^hl=(?<hl>es)(?:-ES|-AR)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
#  - if: '$query_string ~ "^hl=(?:nb|nn)-NO&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=no&url=$url?'
#  - if: '$query_string ~ "^hl=pt-PT&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=pt-BR&url=$url?'
#  - if: '$query_string ~ "^hl=(?<hl>ar|bg|cs|da|de|el|en|en-GB|es|fi|fr|hu|it|iw|ja|ko|nl|no|l|pt-BR|ru|sk|sv|tr|zh-CN|zh-TW)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
#  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
#  # bug 1387246, send lone url query strings to google safebrowsing
#  - if: '$query_string ~ "url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&url=$url?'
#  - redirect: www.mozilla.org/
#  srcs:
#  - phish-report.mozilla.com
#  - '*.phish-report.mozilla.com'
#  tests:
#  - http://phish-report.mozilla.com/?hl=es&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=es&url=path'
#  - http://phish-report.mozilla.com/?hl=nb-NO&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=no&url=path'
#  - http://phish-report.mozilla.com/?hl=pt-PT&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=pt-BR&url=path'
#  - http://phish-report.mozilla.com/?hl=en-GB&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=en-GB&url=path'
#  - http://phish-report.mozilla.com/?hl=zh-TW&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=zh-TW&url=path'
#  - http://phish-report.mozilla.com/?hl=foo&url=bar: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=foo&url=bar'
#  - http://phish-report.mozilla.com/?url=foobar: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&url=foobar'
#  - http://phish-report.mozilla.com/foobar: https://www.mozilla.org/
#  status: 302
