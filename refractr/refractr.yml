# 'status' will default to 301, if unspecified
# 'tests' will be generated except the rewrite case (Ex4)
#
# Ex1 One Source
#   - destination(dsts): source(srcs)
#
#   - wiki.mozilla.org: wiki.mozilla.com
#
#   The loaded data structure will be this:
#
#   - srcs:
#     - wiki.mozilla.com
#     dsts: wiki.mozilla.org/
#     status: 301
#     tests:
#     - http://wiki.mozilla.com: https://wiki.mozilla.org/
#
#   Note: remember the status and tests are defaults if unspecified.
#
# Ex2 Multiple Sources
#   - destination(dsts):
#     - source1
#     - source2
#
#   - www.mozillalabs.com/:
#     - labs.mozilla.org
#     - labs.mozilla.com
#
#   The loaded data structure will be this:
#
#   - srcs:
#     - labs.mozilla.org
#     - labs.mozilla.com
#     dsts: www.mozillalabs.com/
#     status: 301
#     tests:
#     - http://labs.mozilla.com: https://www.mozillalabs.com/
#
#   Note: remember the status and tests are defaults if unspecified.
#
# Ex3 Redirect, Paths -> Destinations
#   - srcs: src(s)
#     dsts:
#       path1: dst1
#       path2: dst2
#
#   - srcs: lockwise.firefox.com
#     dsts:
#     - /faq.html: support.mozilla.org/products/firefox-lockwise/
#     - /addon/updates.json: mozilla-lockwise.github.io/addon/updates.json
#     - /: www.mozilla.org/firefox/lockwise/
#
#   The loaded data structure will be this:
#
#   - srcs:
#     - lockwise.firefox.com
#     dsts:
#     - /faq.html: support.mozilla.org/products/firefox-lockwise/
#     - /addon/updates.json: mozilla-lockwise.github.io/addon/updates.json
#     - /: www.mozilla.org/firefox/lockwise/
#     status: 301
#     tests:
#     - http://lockwise.firefox.com/faq.html: https://support.mozilla.org/products/firefox-lockwise/
#     - http://lockwise.firefox.com/addon/updates.json: https://mozilla-lockwise.github.io/addon/updates.json
#     - http://lockwise.firefox.com/: https://www.mozilla.org/firefox/lockwise/
#
#   Note: Remember the status and tests are defaults if unspecified. Here you
#				  can see how the tests specify src: dst incorporating the path fragments.
#
# Ex4 Rewrite with If and Redirect Directives
#   - srcs: src(s)
#     dsts:
#     - if <some-valid-nginx-predicate>
#       ^: <rewrite>
#     - redirect: (optional) <catchall-redirect> (used when the 'if' condtional fails)
#
#   - srcs:
#     - '*.start.mozilla.com'
#     - '*.start2.mozilla.com'
#     - '*.start3.mozilla.com'
#     - '*.start-prod.mozilla.com'
#     dsts:
#     - if: '$http_host ~ "^(?<lang>[a-z]{2,3}(-[a-z]{2})?)?\.(start.*)$"'
#       ^: start.mozilla.org/$lang$request_uri
#     - redirect: start.mozilla.org/
#     tests:
#     - http://ca.start.mozilla.com: https://start.mozilla.org/ca/
#     - http://en-us.start.mozilla.com: https://start.mozilla.org/en-us/
#     - http://en-uk.start.mozilla.com: https://start.mozilla.org/en-uk/
#
#   The loaded data structure will be this:
#
#   - srcs:
#     - '*.start.mozilla.com'
#     - '*.start2.mozilla.com'
#     - '*.start3.mozilla.com'
#     - '*.start-prod.mozilla.com'
#     dsts:
#     - ^: start.mozilla.org/$lang$request_uri
#       if: $http_host ~ "^(?<lang>[a-z]{2,3}(-[a-z]{2})?)?\.(start.*)$"
#     - redirect: start.mozilla.org/
#     status: 301
#     tests:
#     - http://ca.start.mozilla.com: https://start.mozilla.org/ca/
#     - http://en-us.start.mozilla.com: https://start.mozilla.org/en-us/
#     - http://en-uk.start.mozilla.com: https://start.mozilla.org/en-uk/
#
#   Note: In the complex(native) case the 'src' and 'dst' keys match
#				  exactly. As before, 'status' will default to 301 if not
#				  specified. However, the 'tests' must be specified for rewrites
#				  such as this.
#
# Ex5 Raw Nginx can be specified.
#
#   The tests must be specified along with expected status codes.  Below
#   are two examples of specifiying the raw nginx and tests that expect
#   specified destinations and status code.
#
#   - nginx: |
#       server {
#           server_name phonebook.mozilla.org;
#           location = /tree.php/ {
#               return 302 https://people.mozilla.org/o;
#           }
#           rewrite /search/(.*) https://people.mozilla.org/s?query=$1&who=staff redirect;
#           location = / {
#               return 302 https://people.mozilla.org/;
#           }
#       }
#     tests:
#     - http://phonebook.mozilla.org/tree.php/: https://people.mozilla.org/o
#       status: 302
#     - http://phonebook.mozilla.org/search/test: https://people.mozilla.org/s?query=test&who=staff
#       status: 302
#     - http://phonebook.mozilla.org/: https://people.mozilla.org/
#       status: 302
#
#   - nginx: |
#       server {
#           server_name content.mozilla.org;
#           location = /dmexco {
#               return 302 https://www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team;
#           }
#           rewrite /(.*) https://www.mozilla.org/about/partnerships/contentservices/$1/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team redirect;
#           location = / {
#               return 302 https://www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team;
#           }
#       }
#     tests:
#     - http://content.mozilla.org/dmexco: 'https://www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
#       status: 302
#     - http://content.mozilla.org/test: 'https://www.mozilla.org/about/partnerships/contentservices/test/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
#       status: 302
#     - http://content.mozilla.org/: 'https://www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
#       status: 302

refracts:

# FIXME: these do not currently exist in prod
- www.mozilla.org/:
  - '*.mozilla-redirects.xyz'
  - mozilla-redirects.xyz
  - refractr.allizom.org
  - refractr1.allizom.org

  # bug 537925
  # NOTE: simplified this after testing, this simple redirect is all that is needed
- www.mozilla.org/contribute/: contribute.mozilla.org

  # bug 1263033
- donate.mozilla.org/: join.mozilla.org
  status: 307

  # bug 20170327
- videos.cdn.mozilla.net/:
  - videos-cdn.mozilla.net
  - videos.mozilla.org
  - videos-ssl-cdn.mozilla.net # FIXME: gives access denied; ok?

  # NOTE: changed from http->https after verifying
  #- www.mozillalabs.com/:
  # FIXME: currently both  are valid
  # but going to simplyfly with a redirect from both
  # going to .org
- labs.mozilla.org/:
  - labs.mozilla.org
  - labs.mozilla.com

  # bug 503731, 528747, 537144
- addons.mozilla.org/:
  - extensions.mozilla.org
  - themes.mozilla.org
  - update.mozilla.org
  - updates.mozilla.org
  - addons.update.mozilla.org
  - firefoxaddons.com
  - www.firefoxaddons.com

  # NOTE: changed from http->https after verifying
  #- www.thunderbird.net/:
- www.thunderbird.net/calendar/:
  - lightning-project.org
  #- www.lightning-project.org FIXME: NXDOMAIN

  # bug 510914
  # NOTE: changed from http->https after verifying
- m.wiki.mozilla.org/Main_Page/: library.mozilla.org

  # bug 572191
  # NOTE: changed from http->https after verifying
- crash-stats.mozilla.com/:
  - talkback.mozilla.org
  - talkback-public.mozilla.org
  - talkback-reports.mozilla.org

- blog.mozilla.org/blog/2010/07/15/thanks-for-an-exciting-firefox-cup/:
  - firefoxcup.com
  - firefoxcup2010.com
  #- www.firefoxcup.com
  - www.firefoxcup2010.com

  # bug 613649
- krakenbenchmark.mozilla.org/: krakenbenchmark.mozilla.com

  # bug 614684
- blog.mozilla.org/blog/2008/12/22/congratulations-fox-for-all-wins-impact-mozilla/:
  - impactmozilla.com
  - www.impactmozilla.com

  # bug 681943
- mozillafestival.org/: festival.mozilla.org
  status: 302

  # bug 692904
  # FIXME: apache points to http; this will go to https
- www.mozilla-russia.org/:
  - mozilla.com.ru
  - www.mozilla.com.ru

  # bug 722504
- wiki.mozilla.org/Security/Events/CTF/:
  - mozillactf.org
  #- www.mozillactf.org FIXME: NXDOMAIN
  status: 302

  # bug 695084
- developer.mozilla.org/: dev.mozilla.org

  # bug 749836
- www.mozilla.org/firefox/new/?utm_source=firefox-pt&utm_medium=referral:
  - firefox.pt
  - www.firefox.pt

  # bug 784556, 880423
- mana.mozilla.org/wiki/display/SD/print.mozilla.com/: print.mozilla.com

  # bug 804895
- wiki.mozilla.org/Platform/AreWeFunYet/:
  - arewefunyet.com
  #- www.arewefunyet.com FIXME: NXDOMAIN
  # bug 811323
  # TODO: switch all HTTP sources to use HTTP and HTTPS, currently tests won't pass that way but once they are on Netlify they will
- developer.mozilla.org/demos/devderby/: devderby.mozilla.org

  # bug 855746
  # TODO: figure out why this won't pass tests.  It works for me in curl
- mozilla.ec/:
  - mozillaecuador.org
  #- www.mozillaecuador.org FIXME: NXDOMAIN

  # bug 908234
- blog.mozilla.org/webdev/: webdev.mozilla.org

- www.mozilla.org/MPL/: mpl.mozilla.org

  # bug 941881
  # NOTE: changed from http->https after verifying
- www.mozilla.org/en-US/contribute/studentambassadors/:
  - ambassadors.mozilla.org
  - students.mozilla.org
  - fsa.mozilla.org

  # bug 971390
- www.mozilla.org/ru/firefox/new/:
  - firefoxik.ru
  #- www.firefoxik.ru FIXME: NXDOMAIN

  # bug 998526, 20170328
- docs.google.com/forms/d/1VSlo6TZ5p42LyTx2q7Wd5vQ5hZHvWtA9JN6JWicXmBM/viewform/: confsurvey.mozilla.org

  # bug 850584
  # NOTE: changed from http->https after verifying
  # FIXME: redirect doesnt currently exist but should work
- download.cdn.mozilla.net/: releases.mozilla.org

  # bug 1025191
- www.mozilla.org/en-US/:
  - mozilla.ca
  #- www.mozilla.ca FIXME: NXDOMAIN

  # bug 1035550
- wiki.mozilla.org/: wiki.mozilla.com

  # bug 1136318
  # NOTE: changed from http->https after verifying
- www.mozilla.de/:
  - mozilla.at
  #- www.mozilla.at FIXME: NXDOMAIN

  # bug 1203755
- wiki.mozilla.org/B2G/:
  - boot2gecko.org
  #- www.boot2gecko.org FIXME: NXDOMAIN
  status: 307

  # bug 1056359
- www.mozilla.org/en-US/firefox/new/:
  - mozilla.it
  #- wwww.mozilla.it FIXME: NXDOMAIN

  # bug 1212631, 1427843
  # FIXME: this commented out redirect is incorrect, added correct one below
  #- www.mozilla.org/firefox/new/?utm_source=getfirefox-co-uk&utm_medium=referral: getfirefox.co.uk
- www.mozilla.org/en-GB/firefox/new/: getfirefox.co.uk

  # bug 1212612, 1212612
  # FIXME: this commented out redirect is incorrect, added correct one below
  #- www.mozilla.org/firefox/new/?utm_source=getfirefox-de&utm_medium=referral:
- www.mozilla.org/de/firefox/new/:
  - getfirefox.de
  #- www.getfirefox.de FIXME: NXDOMAIN
  - firefox-hacks.de
  - www.firefox-hacks.de
  - firefox2.de
  - www.firefox2.de

  # bug 1214568
- blog.mozilla.org/creative/: creative.mozilla.org
  status: 302

  # bug 1225273, 1359534
- docs.taskcluster.net/: taskcluster.net
  status: 302

  # bug 1212612, 1427843
- www.mozilla.org/firefox/new/?utm_source=getfirefox-net&utm_medium=referral:
  - getfirefox.net
  #- www.getfirefox.net FIXME: NXDOMAIN

  # bug 1195576
  # FIXME: this commented out redirect is incorrect, added correct one below
  #- mozillafoundation.org:
- foundation.mozilla.org/:
  - mozillafoundation.com
  - mozillafoundation.net

  # bug 1243236
- careers.mozilla.org/:
  - jobs.mozilla.org
  - jobs.mozilla.com
  status: 302

  # bug 1243355
- www.mozilla.org/fy-NL/:
  - mozilla.frl
  #- www.mozilla.frl FIXME: NXDOMAIN
  status: 302

  # bug 1255190
- www.openwebgames.com/: openwebgames.com
  status: 302

  # bug 1259820
- air.mozilla.org/: air.mozilla.com
  status: 302

  # bug 1268570, 1427843
  # FIXME: this commented out redirect is incorrect, added correct one below
  #- www.mozilla.org/firefox/new/?utm_source=firefox-lt&utm_medium=referral:
- www.mozilla.org/lt/firefox/:
  - firefox.lt
  #- www.firefox.lt FIXME: NXDOMAIN

  # bug 1290923
- disconnect.me/trackerprotection/:
  - trackingprotection.info
  #- www.trackingprotection.info FIXME: NXDOMAIN
  status: 302

  # bug 1262196, 1427843
- www.mozilla.org/firefox/new/?utm_source=firefox-hu&utm_medium=referral:
  - firefox.hu
  - www.firefox.hu

  # bug 1311392
- www.mozilla.org/pl/firefox/new/:
  - mozillafirefox.pl
  - www.mozillafirefox.pl
  status: 302

  # bug 1334200
- github.com/mozilla/popcorn-js/:
  - popcornjs.org
    #- www.popcornjs.org

  # bug 1342698
  # NOTE: changed from http->https after verifying
- blog.mozilla.org/: mozillausa.org

- www.mozilla.org/firefox/:
  # bug 838939
  - downloadmozillafirefox.com
  # bug 948963
  - spark.mozilla.org
  status: 302

  # FIXME: change to www subdomain to match prod
- www.mozilla.org/: redirect-san.mozilla.org
  status: 307

  # NOTE: changed from http->https after verifying
  # FIXME: how is this zeus stuff going to work going forward?
- mozilla.org/: redirects-http-only.external.zlb.scl3.mozilla.com

  # bug 688019, 1427843
- www.mozilla.org/firefox/new/?utm_source=getfirefox-org&utm_medium=referral:
  - getfirefox.org
  - www.getfirefox.org

  # virtual-redirect-autogen.conf merged into virtual-redirect
  # this used to be generated by a script somehow, but not now.
  # that script was dnsconfig/bin/generate-virtual-redirects.sh
- www.mozilla.org/:
  #- virtual-redirect-mozilla.org FIXME: NXDOMAIN
  #- virtual-redirect-mozilla.com FIXME: NXDOMAIN
  - mozillaservice.net
  - www.mozillaservice.net
  - firefox4all.com
  - www.firefox4all.com
  - firefoxsoftware.com
  - www.firefoxsoftware.com
  #- getfirfox.com FIXME: valid ip, but MarkMonitor page
  #- www.getfirfox.com FIXME: valid ip, but MarkMonitor page
  - update-firefox.com
  - www.update-firefox.com
  - extendfirefox.com
  - www.extendfirefox.com
  - onemozilla.org
  - www.onemozilla.org
  # bug 1234360
  - firefoxflicks.mozilla.org
  # bug 126196
  - mozilla.hu
  - www.mozilla.hu
  # bug 1331870
  - events.mozspaces.org
  # bug 710695, 708705
  - firefoxflicks.com
  - firefoxflicks.org
  - www.firefoxflicks.com
  - www.firefoxflicks.org
  # fashionyourfirefox.com - Modified as per bug 614412
  - fashionyourfirefox.com
  - www.fashionyourfirefox.com
  # We're not using website-beta right now.
  - website-beta.mozilla.org
  # split out store.mozilla.org|com as per bug 1142629
  # modified for bug 1260869 now that gear.mozilla.org has gone away
  - www.store.mozilla.org
  - store.mozilla.org
  - store.mozilla.com
  # bug 619759
  - www.mozilla.net
  # bug 870904
  - mozsecworld.org
  - www.mozsecworld.org
  # bug 841514
  - detodosparatodos.org
  - www.detodosparatodos.org
  #- detodosparatodos.com FIXME: broken but not NXDOMAIN
  #- www.detodosparatodos.com FIXME: broken but not NXDOMAIN
  # bug 1268570
  - firefox-downloaden.de
  # bug 830904
  - communitystore.mozilla.org
  # TODO: can we decom this?
  # bug 1234360
  - mobilepartners.mozilla.org
  # bug 1329125
  - masterfirefoxos.mozilla.org
  status: 302

  # FIXME: redirect below didnt work; replaced with what is on prod
  #- marketplace.firefox.com/: apps.mozillalabs.com
- www.mozilla.org/: apps.mozillalabs.com

  # bug 1427843
- www.mozilla.org/firefox/new/?utm_source=firefox-be&utm_medium=referral:
  - firefox.be
  - www.firefox.be

  # bug 713065
- wiki.mozilla.org/MarketingGuide/: guides.mozilla.org

  # bug 998357
- activations.cdn.mozilla.net/:
  - activations.mozilla.com
  - activations.mozilla.org

  # bug 1274647
- discourse.mozilla-community.org/c/firefox-development/: ask.mozilla.org
  status: 307

  # bug 1351245
- 'www.mozilla.org/firefox/channel/desktop/#developer': aurora.mozilla.org
  status: 302

  # bug 656457
- 'www.mozilla.org/firefox/channel/#beta': beta.mozilla.org

  # bug 1246674
- careers.mozilla.org/: careers.mozilla.com
  status: 302

  # bug 1185027
- www.contributejson.org/: contributejson.org
  status: 302

  # bug 1335596
  # NOTE: changed redirect to its final destination
- mozilla.design/: designlanguage.mozilla.org

  # bug 1200302
- discourse.mozilla.org/c/add-ons/: forums.mozilla.org
  status: 307

  # bug 1255221
- www.mozilla.org/contribute/friends/: friends.mozilla.org
  status: 302

  # bug 896570, 1427843, 1485429, 1297860
- www.mozilla.org/firefox/new/?redirect_source=getfirefox-com:
  - getfirefox.com
  - www.getfirefox.com

  # bug 896570
- www.mozilla.org/firefox/?redirect_source=getfirefox-com:
  - mozillafirefox.com
  - www.mozillafirefox.com
  - firefoxbrowser.com
  - www.firefoxbrowser.com
  - firefoxbrowser.org
  - www.firefoxbrowser.org

  # bug 1290260
- wiki.mozilla.org/DeveloperServices/HistoricalVCS/: git.mozilla.org
  status: 302

  # bug 1315316
- qsurvey.mozilla.com/s3/FirefoxInput/:
  - m.input.mozilla.org
  - m.input.mozilla.com
  - feedback.mozilla.org
  status: 302

  # bug 1335617
- www.mozilla.org/en-US/about/policy/lean-data/:
  - leandatapractices.org
  - www.leandatapractices.org
  - leandatapractices.com
  - www.leandatapractices.com
  status: 302

  # bug 1301642, 1326390
- 'www.mozilla.org/firefox/channel/#nightly': nightly.mozilla.org
  status: 302

  # bug 985510
- pontoon.mozilla.org/: pontoon.mozillalabs.com

  # bug 1311146
- donate.mozilla.org/: sendto.mozilla.org
  status: 307

  # bug 1340330
  # FIXME: removed www as current redirect goes to the apex
- metricsgraphicsjs.org/:
  - metricsgraphicsjs.org
  - www.metricsgraphicsjs.org

  # bug 1361114
- www.mozilla.org/: webwewant.mozilla.org

- www.mozilla.org/: mozilla-podcasts.org

  # bug 1384357
- www.extensiontest.com/: extensiontest.com
  status: 302

  # bug 1396954
  # FIXME: this commented out redirect is incorrect, added correct one below
  #- research.mozilla.org/mixed-reality: mixedreality.mozilla.org
- mixedreality.mozilla.org/: mixedreality.mozilla.org


  # bug 1414285, 1429854
- onlinexperiences.com/scripts/Server.nxp?LASCmd=L:0&AI=1&InitialDisplay=1&ClientBrowser=0&ShowKey=44908: airmo.mozilla.org

  # bug 1415362
- www.mozilla.org/firefox/?utm_medium=referral&utm_source=firefoxquantum-com: firefoxquantum.com

  # bug 1421587
- medium.com/mozilla-open-innovation/: open.mozilla.org
  status: 302

  # bug 1441865
- mozilla-releng.net/treestatus/: treestatus.mozilla.org
  status: 302

  # bug 1330438
- moz-releng-docs.readthedocs.io/en/latest/: docs.pub.build.mozilla.org

  # bug 1459170
- perf-html.io/: cleopatra.io
  status: 302

  # bug 1461516
- www.mozilla.org/: smartdogz.org
  status: 302

  # bug 1169224, 1473015
- www.mozilla.org/:
  - mozilla.org.uk
  - www.mozilla.org.uk
  status: 302

  # bug 1485991
  # FIXME: previous redirect is not valid
  #- onlinexperiences.com/scripts/Server.nxp?LASCmd=L:0&AI=1&InitialDisplay=1&ClientBrowser=0&ShowKey=44908: air.mozilla.org
- air.mozilla.org/: air.mozilla.org
  status: 308

  # bug 1419948
  # TODO: verify this works as before
- web.archive.org/web/20180106223649/https://webfwd.org/:
  - webfwd.org
  #- www.webfwd.org FIXME: gives SSL Cert Error
  - webfwd.net
  - www.webfwd.net
  status: 307

  # bug 1462137
- hubs.mozilla.com/:
  - hub.mozilla.com
  - hub.mozilla.org

  # bug 1293353
- mozilla.service-now.com/: thehub.mozilla.com
  status: 302

  # bug 1492531
- wiki.mozilla.org/Pastebin/: pastebin.mozilla.org

  # bug 1492428
- www.mozilla.org/en-GB/firefox/new/?utm_source=mozilla-eu&utm_medium=referral:
  - mozilla.eu
  - www.mozilla.eu
  - mozila.eu
  - www.mozila.eu

  # bug 1492428
- www.mozilla.org/fr/firefox/new/?utm_source=mozilla-fr&utm_medium=referral:
  - mozilla.fr
  - www.mozilla.fr

  # bug 1463086
- mozilla.org/nl/:
  - mozilla.nl
  - www.mozilla.nl

  # bug 1522224
- testpilot.firefox.com/: contribute.testpilot.firefox.com

  # bug 1533035
- mozilla.github.io/geckoview/:
  - gv.dev
  - geckoview.dev
  status: 302

  # FIXME: do we need these or assume that nginx ingress will http->https?
- developer.mozilla.com/: developer.mozilla.com

  # FIXME: do we need these or assume that nginx ingress will http->https?
- developer.mozilla.org/: developer.mozilla.org

  # bug 1543423
- discourse.mozilla.org/: discourse.mozilla-community.org

- www.mozilla.org/: triagebot.mozilla.org

  # TODO: test this works as before
  # bug 1304806
- phonebook.mozilla.org/: phonebook.mozilla.com
  status: 302

- pad.mozilla.org/: public.etherpad-mozilla.org

  # bug 1538932
- mozilla.report/: reports.telemetry.mozilla.org

- www.mozilla.org/firefox/lockwise/: lockbox.firefox.com

  # bug 1440375
- www.mozilla.org/pt-BR/: mozilla.com.br

- mozilla.github.io/oi-website/: openinnovation.mozilla.org

  # bug 617681
  # NOTE: changed from http->https after verifying
- blog.mozilla.org/operationfx/2007/12/14/declassified-information-and-the-winner-is/:
  - operationfirefox.com
  - www.operationfirefox.com

  # bug 1596457
- mozilla-spidermonkey.github.io/: spidermonkey.dev

  # bug 1614193
- voice.mozilla.org/fy-NL/: voice.mozilla.frl
  status: 302

  # bug 835529
- support.mozilla.org/: www.support.mozilla.org

  # bug 1502902
  # FIXME: valid anymore, considering the redirects below?
- events.mozilla.org/techspeakers/: techspeakers.mozilla.org

- community.mozilla.org/campaigns/help-firefox-win-on-android-support-users-in-your-language: supportsprint.mozilla.community

  # bug 1627952
- community.mozilla.org/campaigns/common-voice-sprint: voice-sprint.mozilla.community

  # bug 1627952
- community.mozilla.org/campaigns/new-firefox/: newfirefox.mozilla.community

  # bug 1627952
- community.mozilla.org/campaigns/firefox-quantum-sprint/: firefoxsprint.mozilla.community

  # bug 149411
  # NOTE: changed from http->https after verifying
  # FIXME: these currently fail due to the complicated mess
  # validation:
  #   netloc: public
  #   tests:
  #   - http://start.mozilla.com -> https://start.mozilla.org/:
  #       hops:
  #       - 307 http://start.mozilla.com -> https://start.mozilla.com/
  #       - 301 https://start.mozilla.com/ -> http://start.mozilla.org/
  #       - 301 http://start.mozilla.org/ -> https://start.mozilla.org/en-US/
  #       - 301 https://start.mozilla.org/en-US/ -> http://start.mozilla.org/en-us/
  #       - 301 http://start.mozilla.org/en-us/ -> https://start.mozilla.org/en-us/
  #       result: MISMATCHED
  #   - http://start-prod.mozilla.com -> https://start.mozilla.org/:
  #       hops:
  #       - 307 http://start-prod.mozilla.com -> https://start-prod.mozilla.com/
  #       - 301 https://start-prod.mozilla.com/ -> http://start.mozilla.org/
  #       - 301 http://start.mozilla.org/ -> https://start.mozilla.org/en-US/
  #       - 301 https://start.mozilla.org/en-US/ -> http://start.mozilla.org/en-us/
  #       - 301 http://start.mozilla.org/en-us/ -> https://start.mozilla.org/en-us/
  #       result: MISMATCHED
- start.mozilla.org/:
  - start.mozilla.com
  - start-prod.mozilla.com

  # bug 1587941
  # TODO: test this works as before
  #- dsts:
  #  - /faq.html/: support.mozilla.org/products/firefox-lockwise/
  #  - /addon/updates.json/: mozilla-lockwise.github.io/addon/updates.json
  #  - /: www.mozilla.org/firefox/lockwise/
  #  srcs: [lockwise.firefox.com]
  #  status: 301
  #  validation:
  #    netloc: public
  #    tests:
  #    - http://lockwise.firefox.com/faq.html/ -> support.mozilla.org/products/firefox-lockwise/:
  #        hops:
  #        - 301 http://lockwise.firefox.com/faq.html/ -> https://lockwise.firefox.com/faq.html/
  #        - 301 https://lockwise.firefox.com/faq.html/ -> https://support.mozilla.org/products/firefox-lockwise//
  #        - 302 https://support.mozilla.org/products/firefox-lockwise// -> http://support.mozilla.org/en-US/products/firefox-lockwise//
  #        - 301 http://support.mozilla.org/en-US/products/firefox-lockwise// -> https://support.mozilla.org/en-US/products/firefox-lockwise//
  #        result: MISMATCHED
  #    - http://lockwise.firefox.com/addon/updates.json/ -> mozilla-lockwise.github.io/addon/updates.json:
  #        hops:
  #        - 301 http://lockwise.firefox.com/addon/updates.json/ -> https://lockwise.firefox.com/addon/updates.json/
  #        - 301 https://lockwise.firefox.com/addon/updates.json/ -> https://mozilla-lockwise.github.io/addon/updates.json/
  #        result: MISMATCHED
  #    - http://lockwise.firefox.com/ -> www.mozilla.org/firefox/lockwise/:
  #        hops:
  #        - 301 http://lockwise.firefox.com/ -> https://lockwise.firefox.com/
  #        - 301 https://lockwise.firefox.com/ -> https://www.mozilla.org/firefox/lockwise/
  #        - 301 https://www.mozilla.org/firefox/lockwise/ -> http://www.mozilla.org/en-US/firefox/lockwise/
  #        - 301 http://www.mozilla.org/en-US/firefox/lockwise/ -> https://www.mozilla.org/en-US/firefox/lockwise/
  #        result: MISMATCHED
- srcs: lockwise.firefox.com
  dsts:
  - /faq.html/: support.mozilla.org/products/firefox-lockwise//
  - /addon/updates.json/: mozilla-lockwise.github.io/addon/updates.json/
  - /: www.mozilla.org/firefox/lockwise/

  # bug 1627952
- srcs: mozilla.github.io
  dsts:
  - /firefox-accounts-campaign: community.mozilla.org/campaigns/join-firefox-campaign/

  # bug 756358
  # TODO: verify this works as expected
- srcs: dnt.mozilla.org
  dsts:
  # NOTE: changed from http->https after verifying
  - /dnt-enabler.tpl: www.mozilla.org/media/dnt/dnt-enabler.tpl
  - /: www.mozilla.org/firefox/dnt/

  # bug 1119912, 1165757, 1213900, 1200359
  # TODO: verify this works as expected / previously
- srcs: content.mozilla.org
  dsts:
  - /dmexco: 'www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
  - ^/(.+): 'www.mozilla.org/about/partnerships/contentservices/$1/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
  - /: 'www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'
  status: 302
  tests:
    # this test must be specified because rewrites `^/(.+)` will not generate a test
  - http://content.mozilla.org/test: 'https://www.mozilla.org/about/partnerships/contentservices/test/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team'

  # bug 1566155
- srcs: phonebook.mozilla.org
  dsts:
  - /tree.php/: people.mozilla.org/o
  - ^/search/(.*): 'people.mozilla.org/s?query=$1&who=staff'
  - /: people.mozilla.org/
  status: 302
  tests:
    # this test must be specified because rewrites `^/(.*)` will not generate a test
  - http://phonebook.mozilla.org/search/test: https://people.mozilla.org/s?query=test&who=staff

- srcs:
  - firefox.com
  - www.firefox.com
  dsts:
    # bug 1485429, 1432228
  - /switch: www.mozilla.org/firefox/switch/?redirect_source=firefox-com

  - /mobile: www.mozilla.org/firefox/new/?redirect_source=firefox-com

  - /beta: www.mozilla.org/firefox/new/?redirect_source=firefox-com

  - /aurora: www.mozilla.org/firefox/new/?redirect_source=firefox-com

  - /nightly: www.mozilla.org/firefox/new/?redirect_source=firefox-com

  - /m: www.mozilla.org/firefox/new/?redirect_source=firefox-com

  - /tour: www.mozilla.org/firefox/new/?redirect_source=firefox-com

    # bug 870410
  - /universityambassadors: www.mozilla.org/contribute/universityambassadors/?redirect_source=firefox-com

  - /os: www.mozilla.org/firefox/os/?redirect_source=firefox-com

    # bug 1004274
  - /desktop: www.mozilla.org/firefox/desktop/?redirect_source=firefox-com

    # bug 1053356
  - /android: www.mozilla.org/firefox/android/?redirect_source=firefox-com

    # bug 1091132
  - /developer: www.mozilla.org/firefox/developer/?redirect_source=firefox-com

    # bug 1091891
  - /10: www.mozilla.org/firefox/independent/?redirect_source=firefox-com

  - /independant: www.mozilla.org/firefox/new/?redirect_source=firefox-com

    # bug 1098044
  - /hello: www.mozilla.org/firefox/hello/?redirect_source=firefox-com

    # bug 1159397
  - /personal: www.mozilla.org/firefox/personal/?redirect_source=firefox-com

    # FIXME: handle '*' correctly
  - ^/personal/(.*): www.mozilla.org/firefox/new/$1?redirect_source=firefox-com

    # bug 1219380
  - /choose: www.mozilla.org/firefox/choose/?redirect_source=firefox-com

    # bug 896570, 1427843
  - /: www.mozilla.org/firefox/new/?redirect_source=firefox-com

  # bug 1627952
- srcs: activate.mozilla.community
  dsts:
  - /campaigns: community.mozilla.org/campaigns/
  - /commonvoice: community.mozilla.org/activities/contributing-to-common-voice/
  - /en-US/nightly: community.mozilla.org/activities/
  - /webextensions: community.mozilla.org/activities/
  - /rust-hack: community.mozilla.org/activities/
  - /webvr-camp: community.mozilla.org/activities/
  - /webcompat-sprint: community.mozilla.org/activities/
  - /: community.mozilla.org/

  # bug 1618512, 1627952
- srcs: events.mozilla.org
  dsts:
  - /firefoxvoicecampaign: community.mozilla.org/activities/test-firefox-voice/
  - /respond_campaign: community.mozilla.org/campaigns/respond-campaign/
  - /firefoxforgood-surfacingqualitycontentandconversat: community.mozilla.org/campaigns/
  - /becomeabetatestingbughunter: community.mozilla.org/campaigns/become-a-beta-testing-bughunter/
  - /commonvoice100: community.mozilla.org/campaigns/common-voice-100-hours-sprint/
  - /firefox66supportsprint: community.mozilla.org/groups/support-mozilla-sumo/?view=events
  - /firefoxfightsforyoucampaign: community.mozilla.org/campaigns/firefoxfightsforyoucampaign/
  - /darkfunnelEN: community.mozilla.org/campaigns/become-a-dark-funnel-detective/
  - /: community.mozilla.org/events/

- srcs:
  - '*.start.mozilla.com'
  - '*.start2.mozilla.com'
  - '*.start3.mozilla.com'
  - '*.start-prod.mozilla.com'
  dsts:
  - if: '$http_host ~ "^(?<lang>[a-z]{2,3}(-[a-z]{2})?)?\.(start.*)$"'
    ^: start.mozilla.org/$lang$request_uri
  - redirect: start.mozilla.org/
  tests:
  - http://ca.start.mozilla.com/: https://start.mozilla.org/ca/
  - http://en-us.start.mozilla.com/: https://start.mozilla.org/en-us/ # FIXME: note, these don't match current prod
  - http://en-uk.start.mozilla.com/: https://start.mozilla.org/en-uk/

- srcs:
  - malware-error.mozilla.com
  - '*.malware-error.mozilla.com'
  dsts:
  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
    ^/$: 'www.stopbadware.org/firefox?hl=$hl&url=$url?'
  - if: '$query_string ~ "^url=(?<url>[^&]+)"'
    ^/$: 'www.stopbadware.org/firefox?url=$url?'
  - redirect: $host$request_uri
  tests:
  - http://malware-error.mozilla.com/?hl=en&url=path: 'https://www.stopbadware.org/firefox?hl=en&url=path'
  - http://malware-error.mozilla.com/?url=path: 'https://www.stopbadware.org/firefox?url=path'
  - http://malware-error.mozilla.com/: https://malware-error.mozilla.com/
#  status: 307

- srcs:
  - phish-error.mozilla.com
  - '*.phish-error.mozilla.com'
  dsts:
  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&hl=$hl&url=$url?'
  - if: '$query_string ~ "^url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&url=$url?'
  - redirect: $host$request_uri
  tests:
  - http://phish-error.mozilla.com/?hl=en&url=path: 'https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&hl=en&url=path'
  - http://phish-error.mozilla.com/?url=path: 'https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&url=path'
  - http://phish-error.mozilla.com/: https://phish-error.mozilla.com/
#  status: 307

- srcs:
  - phish-report.mozilla.com
  - '*.phish-report.mozilla.com'
  dsts:
  - if: '$query_string ~ "^hl=(?<hl>es)(?:-ES|-AR)&url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
  - if: '$query_string ~ "^hl=(?:nb|nn)-NO&url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=no&url=$url?'
  - if: '$query_string ~ "^hl=pt-PT&url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=pt-BR&url=$url?'
  - if: '$query_string ~ "^hl=(?<hl>ar|bg|cs|da|de|el|en|en-GB|es|fi|fr|hu|it|iw|ja|ko|nl|no|l|pt-BR|ru|sk|sv|tr|zh-CN|zh-TW)&url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
  # bug 1387246, send lone url query strings to google safebrowsing
  - if: '$query_string ~ "url=(?<url>[^&]+)"'
    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&url=$url?'
  - redirect: www.mozilla.org/
  tests:
  - http://phish-report.mozilla.com/?hl=es&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=es&url=path'
  - http://phish-report.mozilla.com/?hl=nb-NO&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=no&url=path'
  - http://phish-report.mozilla.com/?hl=pt-PT&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=pt-BR&url=path'
  - http://phish-report.mozilla.com/?hl=en-GB&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=en-GB&url=path'
  - http://phish-report.mozilla.com/?hl=zh-TW&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=zh-TW&url=path'
  - http://phish-report.mozilla.com/?hl=foo&url=bar: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=foo&url=bar'
  - http://phish-report.mozilla.com/?url=foobar: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&url=foobar'
  - http://phish-report.mozilla.com/foobar: https://www.mozilla.org/
  status: 302
