# these domains will be given a cert and rule through
# the ingress.yaml.template by being added to the domains
# output from refractr.py
default-domains:
  - prod.mozilla-redirects.xyz
  - refractr.mozilla.org

refracts:

  # FIXME: this is a prod test to ensure certs get requested
- mozilla.com/: refractr1.mozilla.org

  # FIXME: this is a prod test to ensure certs get requested
- mozilla.org/: refractr2.mozilla.org

  # bug 20170327
- videos.cdn.mozilla.net/:
  - videos-cdn.mozilla.net
  - videos.mozilla.org
  - videos-ssl-cdn.mozilla.net # FIXME: gives access denied; ok?

  # NOTE: changed from http->https after verifying
  #- www.mozillalabs.com/:
  # FIXME: currently both  are valid
  # but going to simplyfly with a redirect from both
  # going to .org
  # SE-970 bogus redirect FIXME: remove later
#- www.mozillalabs.com/:
#  - labs.mozilla.org
#  - labs.mozilla.com

  # bug 503731, 528747, 537144
- addons.mozilla.org/:
  - extensions.mozilla.org
  - themes.mozilla.org
  - update.mozilla.org
  - updates.mozilla.org
  - addons.update.mozilla.org
  - firefoxaddons.com
  - www.firefoxaddons.com

  # bug 850584
  # NOTE: changed from http->https after verifying
  # FIXME: redirect doesnt currently exist but should work
- download.cdn.mozilla.net/: releases.mozilla.org

  # FIXME: change to www subdomain to match prod
- www.mozilla.org/: redirect-san.mozilla.org
  status: 307

  # bug 998357
- activations.cdn.mozilla.net/:
  - activations.mozilla.com
  - activations.mozilla.org

# FIXME: commenting out LE Blacklisted items for now
# https://mana.mozilla.org/wiki/display/SECURITY/Certificate+Authority+Authorization+CAA+including+Let%27s+Encrypt
#  # bug 896570, 1427843, 1485429, 1297860
#- www.mozilla.org/firefox/new/?redirect_source=getfirefox-com:
#  - getfirefox.com
#  - www.getfirefox.com

  # bug 835529
- support.mozilla.org/: www.support.mozilla.org
  # bug 149411
  # NOTE: changed from http->https after verifying
  # FIXME: these currently fail due to the complicated mess
  # validation:
  #   netloc: public
  #   tests:
  #   - http://start.mozilla.com -> https://start.mozilla.org/:
  #       hops:
  #       - 307 http://start.mozilla.com -> https://start.mozilla.com/
  #       - 301 https://start.mozilla.com/ -> http://start.mozilla.org/
  #       - 301 http://start.mozilla.org/ -> https://start.mozilla.org/en-US/
  #       - 301 https://start.mozilla.org/en-US/ -> http://start.mozilla.org/en-us/
  #       - 301 http://start.mozilla.org/en-us/ -> https://start.mozilla.org/en-us/
  #       result: MISMATCHED
  #   - http://start-prod.mozilla.com -> https://start.mozilla.org/:
  #       hops:
  #       - 307 http://start-prod.mozilla.com -> https://start-prod.mozilla.com/
  #       - 301 https://start-prod.mozilla.com/ -> http://start.mozilla.org/
  #       - 301 http://start.mozilla.org/ -> https://start.mozilla.org/en-US/
  #       - 301 https://start.mozilla.org/en-US/ -> http://start.mozilla.org/en-us/
  #       - 301 http://start.mozilla.org/en-us/ -> https://start.mozilla.org/en-us/
  #       result: MISMATCHED

  # bug 1587941
  # TODO: test this works as before
  #- dsts:
  #  - /faq.html/: support.mozilla.org/products/firefox-lockwise/
  #  - /addon/updates.json/: mozilla-lockwise.github.io/addon/updates.json
  #  - /: www.mozilla.org/firefox/lockwise/
  #  srcs: [lockwise.firefox.com]
  #  status: 301
  #  validation:
  #    netloc: public
  #    tests:
  #    - http://lockwise.firefox.com/faq.html/ -> support.mozilla.org/products/firefox-lockwise/:
  #        hops:
  #        - 301 http://lockwise.firefox.com/faq.html/ -> https://lockwise.firefox.com/faq.html/
  #        - 301 https://lockwise.firefox.com/faq.html/ -> https://support.mozilla.org/products/firefox-lockwise//
  #        - 302 https://support.mozilla.org/products/firefox-lockwise// -> http://support.mozilla.org/en-US/products/firefox-lockwise//
  #        - 301 http://support.mozilla.org/en-US/products/firefox-lockwise// -> https://support.mozilla.org/en-US/products/firefox-lockwise//
  #        result: MISMATCHED
  #    - http://lockwise.firefox.com/addon/updates.json/ -> mozilla-lockwise.github.io/addon/updates.json:
  #        hops:
  #        - 301 http://lockwise.firefox.com/addon/updates.json/ -> https://lockwise.firefox.com/addon/updates.json/
  #        - 301 https://lockwise.firefox.com/addon/updates.json/ -> https://mozilla-lockwise.github.io/addon/updates.json/
  #        result: MISMATCHED
  #    - http://lockwise.firefox.com/ -> www.mozilla.org/firefox/lockwise/:
  #        hops:
  #        - 301 http://lockwise.firefox.com/ -> https://lockwise.firefox.com/
  #        - 301 https://lockwise.firefox.com/ -> https://www.mozilla.org/firefox/lockwise/
  #        - 301 https://www.mozilla.org/firefox/lockwise/ -> http://www.mozilla.org/en-US/firefox/lockwise/
  #        - 301 http://www.mozilla.org/en-US/firefox/lockwise/ -> https://www.mozilla.org/en-US/firefox/lockwise/
  #        result: MISMATCHED
# FIXME: commenting out LE Blacklisted items for now
# https://mana.mozilla.org/wiki/display/SECURITY/Certificate+Authority+Authorization+CAA+including+Let%27s+Encrypt
#- dsts:
#    # bug 1485429, 1432228
#  - /switch: www.mozilla.org/firefox/switch/?redirect_source=firefox-com
#
#  - /mobile: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /beta: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /aurora: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /nightly: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /m: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#  - /tour: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#    # bug 870410
#  - /universityambassadors: www.mozilla.org/contribute/universityambassadors/?redirect_source=firefox-com
#
#  - /os: www.mozilla.org/firefox/os/?redirect_source=firefox-com
#
#    # bug 1004274
#  - /desktop: www.mozilla.org/firefox/desktop/?redirect_source=firefox-com
#
#    # bug 1053356
#  - /android: www.mozilla.org/firefox/android/?redirect_source=firefox-com
#
#    # bug 1091132
#  - /developer: www.mozilla.org/firefox/developer/?redirect_source=firefox-com
#
#    # bug 1091891
#  - /10: www.mozilla.org/firefox/independent/?redirect_source=firefox-com
#
#  - /independant: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#
#    # bug 1098044
#  - /hello: www.mozilla.org/firefox/hello/?redirect_source=firefox-com
#
#    # bug 1159397
#  - /personal: www.mozilla.org/firefox/personal/?redirect_source=firefox-com
#
#    # FIXME: handle '*' correctly
#  - ^/personal/(.*): www.mozilla.org/firefox/new/$1?redirect_source=firefox-com
#
#    # bug 1219380
#  - /choose: www.mozilla.org/firefox/choose/?redirect_source=firefox-com
#
#    # bug 896570, 1427843
#  - /: www.mozilla.org/firefox/new/?redirect_source=firefox-com
#  srcs:
#  - firefox.com
#  - www.firefox.com

#- dsts:
#  - if: '$http_host ~ "^(?<lang>[a-z]{2,3}(-[a-z]{2})?)?\.(start.*)$"'
#    ^: start.mozilla.org/$lang$request_uri
#  - redirect: start.mozilla.org/
#  srcs:
#  - '*.start.mozilla.com'
#  - '*.start2.mozilla.com'
#  - '*.start3.mozilla.com'
#  - '*.start-prod.mozilla.com'
#  tests:
#  - http://ca.start.mozilla.com/: https://start.mozilla.org/ca/
#  - http://en-us.start.mozilla.com/: https://start.mozilla.org/en-us/ # FIXME: note, these don't match current prod
#  - http://en-uk.start.mozilla.com/: https://start.mozilla.org/en-uk/
#
#- dsts:
#  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
#    ^/$: 'www.stopbadware.org/firefox?hl=$hl&url=$url?'
#  - if: '$query_string ~ "^url=(?<url>[^&]+)"'
#    ^/$: 'www.stopbadware.org/firefox?url=$url?'
#  - redirect: $host$request_uri
#  srcs:
#  - malware-error.mozilla.com
#  - '*.malware-error.mozilla.com'
#  tests:
#  - http://malware-error.mozilla.com/?hl=en&url=path: 'https://www.stopbadware.org/firefox?hl=en&url=path'
#  - http://malware-error.mozilla.com/?url=path: 'https://www.stopbadware.org/firefox?url=path'
#  - http://malware-error.mozilla.com/: https://malware-error.mozilla.com/
##  status: 307
#
#- dsts:
#  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&hl=$hl&url=$url?'
#  - if: '$query_string ~ "^url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&url=$url?'
#  - redirect: $host$request_uri
#  srcs:
#  - phish-error.mozilla.com
#  - '*.phish-error.mozilla.com'
#  tests:
#  - http://phish-error.mozilla.com/?hl=en&url=path: 'https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&hl=en&url=path'
#  - http://phish-error.mozilla.com/?url=path: 'https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&url=path'
#  - http://phish-error.mozilla.com/: https://phish-error.mozilla.com/
##  status: 307
#
#- dsts:
#  - if: '$query_string ~ "^hl=(?<hl>es)(?:-ES|-AR)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
#  - if: '$query_string ~ "^hl=(?:nb|nn)-NO&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=no&url=$url?'
#  - if: '$query_string ~ "^hl=pt-PT&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=pt-BR&url=$url?'
#  - if: '$query_string ~ "^hl=(?<hl>ar|bg|cs|da|de|el|en|en-GB|es|fi|fr|hu|it|iw|ja|ko|nl|no|l|pt-BR|ru|sk|sv|tr|zh-CN|zh-TW)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
#  - if: '$query_string ~ "^hl=(?<hl>[^&]+)&url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=$hl&url=$url?'
#  # bug 1387246, send lone url query strings to google safebrowsing
#  - if: '$query_string ~ "url=(?<url>[^&]+)"'
#    ^/$: 'safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&url=$url?'
#  - redirect: www.mozilla.org/
#  srcs:
#  - phish-report.mozilla.com
#  - '*.phish-report.mozilla.com'
#  tests:
#  - http://phish-report.mozilla.com/?hl=es&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=es&url=path'
#  - http://phish-report.mozilla.com/?hl=nb-NO&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=no&url=path'
#  - http://phish-report.mozilla.com/?hl=pt-PT&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=pt-BR&url=path'
#  - http://phish-report.mozilla.com/?hl=en-GB&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=en-GB&url=path'
#  - http://phish-report.mozilla.com/?hl=zh-TW&url=path: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=zh-TW&url=path'
#  - http://phish-report.mozilla.com/?hl=foo&url=bar: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&hl=foo&url=bar'
#  - http://phish-report.mozilla.com/?url=foobar: 'https://safebrowsing.google.com/safebrowsing/report_phish/?tpl=mozilla&url=foobar'
#  - http://phish-report.mozilla.com/foobar: https://www.mozilla.org/
#  status: 302
