language: python
python:
 - "3.7"
service:
 - docker
branches:
  except:
  - flux-sync-refractr-prod
  - flux-sync-refractr-stage
install:
  - git fetch --unshallow --tags
  - VERSION=$(git describe --match "v*" --abbrev=7)
  - pip install doit
  - pip install -r requirements.txt
script:
  - doit test
  - echo test
  - echo "${DOCKER_PASSWORD}" | docker login --username "${DOCKER_USER}" --password-stdin
  - docker push "itsre/refractr:$VERSION"
env:
  global:
  - secure: WzfRonZ0EGZRZR16C5KTuJgzbW3fFjAPYW5H9bTIAgM3pfVFNKP7hbTvL7lcpEzEuixjmqNPH59Q4jJi1qtgqHXZj9I4+xhd2/FskwWukg/Am5TQy1fr6WcbEkit97vZokDfaCanmL9RR0IXEdhkf2QmM5Uy2CoyXqmJCi3IxXu+cpTjW53rxW2eFmpE0CrQo/Jgu+wqr25SiCvTjqMInDYxK1vHwocN3zGQ1iEZlwfbTqi6bYCSQBhqeTBmOpEA2N3SOspRalFotqRAyaOarqgBlgPPfe9xs8wwxdO6sp30K3w3rm2gCCVrNbkgkIzDr1pFVIR6s1GLhdESGNIMBu1mNJA0DBxcCCYBGTWIGI/mdO9/Mz0csO8xadI4TU3dNAJcppZfnXbAPT40M628YuZbkNd7kfnGP9rq6Evc/2cMSVG63ud0L9w/Z3Xf+HiseLwp2m8QWU7JEbHKu84NjBdj9mmJyu/zkf2J8iUZXffIvSjR4LLR731ODCfKdZqzzjhxk6SzarwHSk6lCJE0Ul/FF4CZ5feRiRnKipFWnah3UOsi4nDpX34hXueQPfS/GPBRUNfQvCs9XOzug79nUxyqpF0Qx/pt8rRjXlklb1Kunc3hH8y6uQSRORwJ11zFy2ABVcWnQBHEaBkBlv4GFP4Ins/tT02YnTJTpluWbHM=
  - secure: fPj0l8UMYt8eUK7xeqt9jjYBEKUdazPAiYtf8cupjlyHcqWr0wFLvQdzAyFmiGG7uWWeNuIZT+f4KTBjeQnV6I2tfge+t/4lrY+w9nnTNttGtZz6L3EI6sdqYj3hkH/RDapr7VTvGj0CCnq2dzmrxvi0mVuEN4OWFyAhCZOJQ6I/6GVfn7zoN+cFTUQtYvcWLZj0bxR3F+ctJECuCKgYlpqPRI1MpBeslv6uMK0lpju8/yIXPnIKTMf5p44vkS5Uy4ZlfNSpJoBLXsAdwVvCoob/JuAbE2ji7w3YbiNuUfL71hFrzluSZN/04r67Hp6anQGbSiwNErLO7t0ZRetEG3nw+VUWN2kkaIkNg4gP42v2DQWyTo0NWiZfu/WtK1sCHNlH/7K1NoapNukzXZ9IMvhzZ3SiB2HMQt2fS84OG9lwuxs+sxPa+W63nury/vVVYhliRc7XAXA61jp+Qa8xNPFMjza1R6F7YtxP7wBUMGOILiAZ7p4x/hucWKXsVmcALqslY1mr/mrP7KHNGptWfdNQfTDUsPSn7w5+pFQnCc+DOofw0CUSC9EAtC29BeKA27sCThGWqK5fiJ+V0wledifxfOsItWosBHobzvKL2KUfOOepzrf8ui2AJ+3r2KzH4WQrstMXOnIN7uEySFxg54X5xIljtQfovtxxhRchdHQ=
